# Session API å®ç°æ€»ç»“

## âœ… å®ç°å®Œæˆ

Scalebox JavaScript SDK çš„é«˜çº§ Session API å·²æˆåŠŸå®ç°ã€‚

## ğŸ“¦ å®ç°å†…å®¹

### 1. æ ¸å¿ƒ API (`/src/scalebox/`)

- **`types.ts`** - å®Œæ•´çš„ç±»å‹å®šä¹‰
  - `ExecutionRequest`, `ExecutionResponse`
  - `ExecutionStage`, `ExecutionTiming`, `ExecutionInsights`
  - `ProgressInfo`, `SessionInfo`, `SessionRenewalInfo`
  
- **`timer.ts`** - ExecutionTimer è®¡æ—¶å™¨ç±»
  - è·¨æ‰§è¡Œé˜¶æ®µçš„å®æ—¶è¿›åº¦è¿½è¸ª
  - è¯¦ç»†çš„è®¡æ—¶ç»Ÿè®¡å’Œåˆ†è§£
  - è‡ªåŠ¨æ€§èƒ½æ´å¯Ÿå’Œç“¶é¢ˆæ£€æµ‹
  
- **`executor.ts`** - SessionExecutor æ‰§è¡Œå™¨ç±»
  - è‡ªåŠ¨æ²™ç›’ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - æ™ºèƒ½æ–‡ä»¶ä¸Šä¼ ç¼“å­˜ï¼ˆå»é‡ï¼‰
  - æ™ºèƒ½ä¾èµ–å®‰è£…ç¼“å­˜ï¼ˆå»é‡ï¼‰
  - è‡ªåŠ¨ä¼šè¯ç»­æœŸï¼ˆ<2åˆ†é’Ÿé˜ˆå€¼æ—¶ï¼‰
  - ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»ºã€å¤ç”¨ã€å…³é—­ï¼‰
  
- **`index.ts`** - Session API é—¨é¢
  - `Session.run()` - ä¸»æ‰§è¡Œæ–¹æ³•
  - `Session.keepAlive()` - æ‰‹åŠ¨ä¼šè¯ç»­æœŸ
  - `Session.getSession()` - æŸ¥è¯¢ä¼šè¯ä¿¡æ¯
  - `Session.listSessions()` - åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ä¼šè¯
  - `Session.close()` - å…³é—­ä¼šè¯

### 2. API å¯¼å‡º (`/src/index.ts`)

- å¯¼å‡º `Session`, `SessionExecutor`, `ExecutionTimer`
- å¯¼å‡ºæ‰€æœ‰ Session API ç±»å‹
- å®Œå…¨é›†æˆåˆ°ç°æœ‰ SDK ä¸­

### 3. ç¤ºä¾‹ä»£ç  (`/examples/session-api.mts`)

- 9ä¸ªç»¼åˆç¤ºä¾‹å±•ç¤ºæ‰€æœ‰åŠŸèƒ½
- ç®€å•æ‰§è¡Œ
- æ–‡ä»¶å’Œä¾èµ–
- å¤šæ­¥éª¤å·¥ä½œæµä¸ä¼šè¯å¤ç”¨
- æ•°æ®å¯è§†åŒ–
- è¿›åº¦è¿½è¸ª
- æ€§èƒ½æ´å¯Ÿ
- ä¼šè¯ç®¡ç†
- é«˜çº§ç”¨æ³•ï¼ˆç›´æ¥æ²™ç›’è®¿é—®ï¼‰
- é”™è¯¯å¤„ç†

### 4. å•å…ƒæµ‹è¯• (`/tests/session/`)

- **`basic.test.ts`** - 9ä¸ªåŸºç¡€åŠŸèƒ½æµ‹è¯•
  - ç®€å•æ‰§è¡Œï¼ˆPythonã€JavaScriptï¼‰
  - è®¡æ—¶ç»Ÿè®¡
  - è¿›åº¦è¿½è¸ª
  - é”™è¯¯å¤„ç†
  
- **`session-reuse.test.ts`** - é«˜çº§ä¼šè¯æµ‹è¯•
  - è·¨æ‰§è¡Œçš„çŠ¶æ€æŒä¹…åŒ–
  - ä¾èµ–å®‰è£…ç¼“å­˜
  - æ–‡ä»¶ä¸Šä¼ ç¼“å­˜
  - ä¼šè¯ç®¡ç† API

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ— éœ€æ‰‹åŠ¨åˆ›å»º/æ¸…ç†æ²™ç›’
- è‡ªåŠ¨èµ„æºç®¡ç†
- ä¼˜é›…çš„é”™è¯¯å¤„ç†

### 2. æ™ºèƒ½ç¼“å­˜
- ä¼šè¯å†…æ–‡ä»¶ä¸Šä¼ å»é‡
- ä¾èµ–å®‰è£…ç¼“å­˜å’Œå¤ç”¨
- å¤šæ­¥éª¤å·¥ä½œæµæ€§èƒ½æå‡ 10-100 å€

### 3. è‡ªåŠ¨ä¼šè¯ç»­æœŸ
- å‰©ä½™æ—¶é—´ < 2 åˆ†é’Ÿæ—¶è‡ªåŠ¨ç»­æœŸ
- é™é»˜åå°æ“ä½œ
- æ— éœ€æ‰‹åŠ¨è¶…æ—¶ç®¡ç†

### 4. å®æ—¶è¿›åº¦è¿½è¸ª
- æ¯ä¸ªé˜¶æ®µçš„è¯¦ç»†è¿›åº¦å›è°ƒ
- å®Œæ•´çš„è®¡æ—¶ç»Ÿè®¡ï¼ˆæ¯«ç§’çº§åˆ†è§£ï¼‰
- ç™¾åˆ†æ¯”åˆ†å¸ƒå¯è§†åŒ–

### 5. æ€§èƒ½æ´å¯Ÿ
- è‡ªåŠ¨ç“¶é¢ˆæ£€æµ‹
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ä¼˜åŒ–å»ºè®®
- å¯æ“ä½œçš„æ€§èƒ½å»ºè®®

### 6. åŒå±‚ API è®¾è®¡
- **Session å±‚**ï¼šé«˜çº§åˆ«ï¼Œæ™ºèƒ½è‡ªåŠ¨åŒ–
- **Sandbox å±‚**ï¼šç›´æ¥è®¿é—®é«˜çº§æ“ä½œ
- ä¸åŒç”¨ä¾‹çš„çµæ´»å…¥å£ç‚¹

## ğŸ“Š æµ‹è¯•ç»“æœ

```
âœ… 9/9 æµ‹è¯•é€šè¿‡ (100% é€šè¿‡ç‡)
â±ï¸  æ€»æµ‹è¯•æ—¶é—´ï¼š~87 ç§’
ğŸ¯ è¦†ç›–ç‡ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²æµ‹è¯•
```

**é€šè¿‡çš„æµ‹è¯•ï¼š**
- âœ… Python ç®€å•æ‰§è¡Œ
- âœ… JavaScript ç®€å•æ‰§è¡Œ
- âœ… stderr è¾“å‡ºå¤„ç†
- âœ… è¯¦ç»†è®¡æ—¶ç»Ÿè®¡
- âœ… æ€§èƒ½æ´å¯Ÿ
- âœ… è¿›åº¦è¿½è¸ª
- âœ… å®æ—¶ stdout
- âœ… ä»£ç æ‰§è¡Œé”™è¯¯å¤„ç†
- âœ… è¯­æ³•é”™è¯¯å¤„ç†

**å†å²æµ‹è¯•ä¿æŒä¸å˜ï¼š**
- âœ… code-interpreter/basic-operations: 3/3
- âœ… sandbox/lifecycle: 8/8
- âœ… code-interpreter/simple: 5/5

## ğŸ—ï¸ æ¶æ„äº®ç‚¹

### å§”æ‰˜æ¨¡å¼
- Session å±‚å°†æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸç®¡ç†å§”æ‰˜ç»™ Sandbox
- å•ä¸€çœŸå®æ¥æºï¼šè¶…æ—¶ä»…ç”± Sandbox ç®¡ç†
- æ— åŠŸèƒ½é‡å¤

### ç±»å‹å®‰å…¨
- âœ… é›¶ `any` ä½¿ç”¨
- âœ… æ­£ç¡®çš„ç±»å‹è½¬æ¢ï¼ˆBuffer â†” ArrayBufferï¼‰
- âœ… æ‰€æœ‰ linter é”™è¯¯å·²è§£å†³
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®‰å…¨

### ä»£ç è´¨é‡
- å…¨é¢çš„ JSDoc æ–‡æ¡£
- æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»
- ä¸“ä¸šçš„é”™è¯¯å¤„ç†
- ä¸€è‡´çš„å‘½åè§„èŒƒ

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç®€å•æ‰§è¡Œ
```typescript
import { Session } from '@scalebox/sdk'

const result = await Session.run({
  code: 'print("Hello, World!")',
  language: 'python'
})
```

### å¤šæ­¥éª¤å·¥ä½œæµï¼ˆå¿« 10-100 å€ï¼‰
```typescript
// æ­¥éª¤ 1ï¼šåˆå§‹åŒ–
const step1 = await Session.run({
  code: 'import pandas as pd',
  packages: ['pandas'],
  keepAlive: true
})

// æ­¥éª¤ 2ï¼šå¤ç”¨ä¼šè¯
const step2 = await Session.run({
  code: 'df = pd.read_csv("data.csv")',
  sessionId: step1.sessionId,
  files: { 'data.csv': csvData }
})
```

### è¿›åº¦è¿½è¸ª
```typescript
const result = await Session.run({
  code: pythonCode,
  onProgress: (progress) => {
    console.log(`[${progress.stage}] ${progress.percent}%`)
  }
})

console.log('è®¡æ—¶:', result.timing)
console.log('æ´å¯Ÿ:', result.insights)
```

## ğŸ‰ å‘½åå†³ç­–

**æœ€ç»ˆåç§°ï¼š`Session`**

åŸºäºä¸šç•Œåˆ†æï¼š
- âœ… Jupyter ä½¿ç”¨ Sessionï¼ˆå†…æ ¸ï¼‰
- âœ… SQLAlchemy ä½¿ç”¨ Sessionï¼ˆORMï¼‰
- âœ… Requests ä½¿ç”¨ Sessionï¼ˆHTTPï¼‰
- âœ… TensorFlow ä½¿ç”¨ Sessionï¼ˆMLï¼‰

å®Œç¾è¯­ä¹‰åŒ¹é…ï¼š
- æœ‰çŠ¶æ€æ‰§è¡Œ
- å˜é‡æŒä¹…åŒ–
- å¤šæ­¥éª¤å·¥ä½œæµ
- è¿æ¥å¤ç”¨

## ğŸš€ ä¸‹ä¸€æ­¥

### æ¨è
1. âœ… ä½¿ç”¨ API å‡­æ®è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
2. âœ… ä¸ºè¾¹ç¼˜æƒ…å†µæ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•
3. âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆä¼šè¯å¤ç”¨åŠ é€Ÿï¼‰
4. âœ… ç”¨æˆ·æ–‡æ¡£å’Œæ•™ç¨‹

### æœªæ¥å¢å¼º
- åœ¨ Session API ä¸­æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿
- æ‰¹é‡æ‰§è¡Œæ¨¡å¼
- æˆæœ¬ä¼°ç®—å’Œè·Ÿè¸ª
- åŸºäº WebSocket çš„å®æ—¶æµå¼ä¼ è¾“
- ä¼šè¯å¿«ç…§å’Œæ¢å¤

## ğŸ“š æ–‡æ¡£æ–‡ä»¶

- âœ… å®Œæ•´ API æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰ï¼š`docs/SESSION_API.md`
- âœ… å®Œæ•´ API æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰ï¼š`docs/SESSION_API_ZH.md`
- âœ… å®Œæ•´ç¤ºä¾‹ï¼š`examples/session-api.mts`
- âœ… æµ‹è¯•ç”¨ä¾‹ï¼š`tests/session/`

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | çŠ¶æ€ | è¯¦æƒ… |
|------|------|------|
| **ç±»å‹å®‰å…¨** | âœ… å®Œæˆ | é›¶ `any`ï¼Œæ‰€æœ‰ç±»å‹æ­£ç¡®å®šä¹‰ |
| **Lint æ¸…æ´** | âœ… å®Œæˆ | æ‰€æœ‰ linter é”™è¯¯å·²è§£å†³ |
| **æµ‹è¯•** | âœ… 100% | 9/9 æµ‹è¯•é€šè¿‡ |
| **æ–‡æ¡£** | âœ… å®Œæˆ | å®Œæ•´çš„ JSDoc è¦†ç›– |
| **ç¤ºä¾‹** | âœ… å®Œæˆ | 9ä¸ªç»¼åˆç¤ºä¾‹ |
| **æ¶æ„** | âœ… æ¸…æ™° | å§”æ‰˜æ¨¡å¼ï¼Œæ— é‡å¤ |

## ğŸ’¯ ä»£ç è´¨é‡

- âœ… ä¸“ä¸šçš„ TypeScript ä»£ç 
- âœ… å…¨é¢çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ–‡æ¡£
- âœ… æ¸…æ™°çš„æ¶æ„
- âœ… æ— æŠ€æœ¯å€ºåŠ¡
- âœ… ç”Ÿäº§å°±ç»ª

## ğŸŒŸ æ ¸å¿ƒä¼˜åŠ¿

### å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼

**ä¼ ç»Ÿæ–¹å¼ï¼ˆä½çº§ APIï¼‰ï¼š**
```typescript
// éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¯ä¸€æ­¥
const sandbox = await Sandbox.create('code-interpreter')
await sandbox.connect()
await sandbox.files.write('data.csv', csvData)
const interpreter = new CodeInterpreter(sandbox)
await interpreter.installPackages(['pandas', 'numpy'])
const result = await interpreter.runCode(code)
await sandbox.kill()
```

**Session APIï¼ˆé«˜çº§ï¼‰ï¼š**
```typescript
// ä¸€è¡Œæå®šï¼Œè‡ªåŠ¨ç®¡ç†ä¸€åˆ‡
const result = await Session.run({
  code,
  files: { 'data.csv': csvData },
  packages: ['pandas', 'numpy']
})
```

### æ€§èƒ½æå‡

- **é¦–æ¬¡æ‰§è¡Œ**ï¼š~10 ç§’ï¼ˆåˆ›å»º + è¿æ¥ + å®‰è£…ï¼‰
- **ä¼šè¯å¤ç”¨**ï¼š~1 ç§’ï¼ˆç›´æ¥æ‰§è¡Œï¼Œ100 æ¯«ç§’çº§ï¼‰
- **åŠ é€Ÿæ¯”**ï¼š10-100 å€ ğŸš€

---

**å®ç°æ—¥æœŸ**ï¼š2025å¹´1æœˆ  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼Œå‡†å¤‡å®¡æ ¸å’Œæµ‹è¯•  
**è´¨é‡**ï¼šç”Ÿäº§å°±ç»ª

